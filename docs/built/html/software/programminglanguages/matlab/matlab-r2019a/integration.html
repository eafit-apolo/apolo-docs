

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Contents &mdash; apolo-docs 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/sidebar.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Python" href="../../python/index.html" />
    <link rel="prev" title="Tested on (Requirements)" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

  
    <a href="../../../../index.html">
  

  
    
    <img src="../../../../_static/apolo-white.png" style="width: 150px;" class="logo" alt="Logo"/>
  
    </a>

    
      
      
      
	<div class="version" style="color: rgba(255,255,255,0.5);">
	  0.1
	</div>
      
    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../gettingstarted/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../supercomputers/index.html">Supercomputers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Software</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../virtualization/index.html">Virtualization</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Programming Languages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">MATLAB</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../matlab-r2018a/index.html">MATLAB - R2018a</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">MATLAB - R2019a</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#resources">Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../python/index.html">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../R/index.html">R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ruby/index.html">Ruby</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../applications/index.html">Scientific Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../resourcemanager/index.html">Resource Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../monitoring/index.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operatingsystems/index.html">Operating Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../scientific_libraries/index.html">Scientific Libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how-to-acknowledge.html">How to Acknowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../report-a-bug.html">Report a Bug</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">apolo-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Software</a> &raquo;</li>
        
          <li><a href="../../index.html">Programming Languages</a> &raquo;</li>
        
          <li><a href="../index.html">MATLAB</a> &raquo;</li>
        
          <li><a href="index.html">MATLAB - R2019a</a> &raquo;</li>
        
      <li><strong>Contents</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/software/programminglanguages/matlab/matlab-r2019a/integration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contents">
<h1><strong>Contents</strong><a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#mdcs-using-a-local-matlab-client" id="id15">MDCS using a local MATLAB client</a></p>
<ul>
<li><p><a class="reference internal" href="#integration-scripts" id="id16">Integration scripts</a></p></li>
<li><p><a class="reference internal" href="#configuring-cluster-profiles" id="id17">Configuring cluster profiles</a></p></li>
<li><p><a class="reference internal" href="#submitting-jobs" id="id18">Submitting jobs</a></p></li>
<li><p><a class="reference internal" href="#debugging" id="id19">Debugging</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#mdcs-using-cluster-s-matlab-client" id="id20">MDCS using cluster’s MATLAB client</a></p>
<ul>
<li><p><a class="reference internal" href="#submitting-jobs-from-within-matlab-client-on-the-cluster" id="id21">Submitting jobs from within MATLAB client on the cluster</a></p></li>
<li><p><a class="reference internal" href="#submitting-jobs-directly-through-slurm" id="id22">Submitting jobs directly through SLURM</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#matlab-directly-on-the-cluster" id="id23">MATLAB directly on the cluster</a></p>
<ul>
<li><p><a class="reference internal" href="#unattended-job" id="id24">Unattended job</a></p></li>
<li><p><a class="reference internal" href="#interactive-job-no-gui" id="id25">Interactive job (No GUI)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id26">References</a></p></li>
</ul>
</div>
<div class="section" id="mdcs-using-a-local-matlab-client">
<h2><a class="reference external" href="https://la.mathworks.com/products/distriben.html">MDCS</a> using a local MATLAB client<a class="headerlink" href="#mdcs-using-a-local-matlab-client" title="Permalink to this headline">¶</a></h2>
<p>To submit jobs through a local MATLAB client in Apolo II or Cronos using
<a class="reference external" href="https://www.schedmd.com/">SLURM</a> follow next steps to got the integration:</p>
<div class="section" id="integration-scripts">
<h3><a class="toc-backref" href="#id16">Integration scripts</a><a class="headerlink" href="#integration-scripts" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Add the MATLAB integration scripts to your MATLAB PATH by placing the
integration scripts into a directory in your PC. (<a class="reference download internal" download="" href="../../../../_downloads/24dd4737c852954f441068c3c77c2154/matlab-apolo-R2019a.zip"><code class="xref download docutils literal notranslate"><span class="pre">matlab-apolo.zip</span></code></a>).</p>
<blockquote>
<div><ul>
<li><p>e.g. <code class="code bash docutils literal notranslate"><span class="name variable"><span class="pre">$HOME</span></span><span class="pre">/Documents/matlab-integration</span></code></p>
<p><br/></p>
</li>
</ul>
<div class="admonition-linux admonition">
<p class="admonition-title">Linux</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir <span class="nv">$HOME</span>/Documents/matlab-integration
mv path-to-file/matlab-apolo-R2019a.zip <span class="nv">$HOME</span>/matlab-integration/
<span class="nb">cd</span> <span class="nv">$HOME</span>/Documents/matlab-integration
unzip matlab-apolo-R2019a.zip
rm matlab-apolo-R2019a.zip
</pre></div>
</div>
</div>
</div></blockquote>
</li>
<li><p>Open your MATLAB client to configure it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MATLAB client is installed in a system directory, we strongly suggest to
open it with admin privileges, it is only necessary the first time to
configure it.</p>
</div>
<img alt="MATLAB client" src="../../../../_images/MATLAB_R2019a.png" />
<p><br/></p>
</li>
<li><p>Add the integrations scripts to the MATLAB PATH</p>
<ul>
<li><p>Press the <strong>“Set Path”</strong> button</p>
<img alt="Set path button" src="../../../../_images/set-path1.png" />
</li>
</ul>
<p><br/></p>
<ul>
<li><p>Press the <strong>“Add with Subfolders”</strong> button and choose the directories where
you unzip the integrations scripts (Apolo II and Cronos) and finally
press the <strong>“Save”</strong> button:</p>
<ul class="simple">
<li><p><code class="code bash docutils literal notranslate"><span class="name variable"><span class="pre">$HOME</span></span><span class="pre">/matlab-integration/EAFIT.nonshared.R2019a</span></code></p></li>
</ul>
<p><br/></p>
<img alt="Subfolders" src="../../../../_images/Set_Path_1.png" />
<p><br/></p>
<img alt="Subfolders" src="../../../../_images/Add_Subfolders.png" />
<p><br/></p>
<img alt="Save changes" src="../../../../_images/Set_Path_2.png" />
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="configuring-cluster-profiles">
<h3><a class="toc-backref" href="#id17">Configuring cluster profiles</a><a class="headerlink" href="#configuring-cluster-profiles" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>Configure MATLAB to run parallel jobs on your cluster by calling
<code class="code docutils literal notranslate"><span class="pre">configCluster</span></code>. It will prompt you for a cluster selection if the user wants to use Apolo or Cronos nodes.</p>
<img alt="MATLAB client" src="../../../../_images/configCluster.png" />
<p><br/></p>
</li>
<li><p>Modify the cluster profile through a variable definition <code class="code bash docutils literal notranslate"><span class="name variable"><span class="pre">c</span></span> <span class="operator"><span class="pre">=</span></span> <span class="pre">parcluster</span></code>.</p>
<img alt="../../../../_images/Selection_058.png" src="../../../../_images/Selection_058.png" />
<p><br/></p>
</li>
<li><p>Set the custom options as you need.</p>
<img alt="../../../../_images/Selection_059.png" src="../../../../_images/Selection_059.png" />
<p><br/></p>
</li>
</ol>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TimeLimit</span></code> <span class="raw-html">&rarr;</span> (<strong>Mandatory</strong>) Set a limit on the total run time of the job
allocation (more <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">info</a>).</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">TimeLimit</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘3-10:00:00’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">AccountName</span></code> <span class="raw-html">&rarr;</span> Change the default user account on Slurm.</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AccountName</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘apolo’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ClusterHost</span></code> <span class="raw-html">&rarr;</span> Another way to change the cluster hostname
to submit jobs.</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">ClusterHost</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘apolo.eafit.edu.co’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EmailAddress</span></code> <span class="raw-html">&rarr;</span> Get all job notifications by e-mail.</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">EmailAddress</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘apolo&#64;eafit.edu.co’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EmailType</span></code> <span class="raw-html">&rarr;</span> Get only the desired notifications based on
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html">sbatch options</a>.</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">EmailType</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘END,TIME_LIMIT_50’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MemUsage</span></code> <span class="raw-html">&rarr;</span>  Total amount of memory <strong>per machine</strong>
(more <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">info</a>).</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">MemUsage</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘5G’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">NumGpus</span></code> <span class="raw-html">&rarr;</span>  Number of GPUs to use in a job.</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">NumGpus</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal number integer"><span class="pre">2</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The maximum value for  <code class="docutils literal notranslate"><span class="pre">NumGpus</span></code> is four, also if you select this option
you should use the <strong>‘accel’</strong> partition on <a class="reference internal" href="../../../../supercomputers/apolo-ii/index.html#about-apolo-ii"><span class="std std-ref">Apolo II</span></a>.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Partition</span></code> <span class="raw-html">&rarr;</span> Select the desire partition to submit jobs
(by default <em>longjobs</em> partition will be used)</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">Partition</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘bigmem’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Reservation</span></code> <span class="raw-html">&rarr;</span> Submit a job into a reservation
(more <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">info</a>).</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">Reservation</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘reservationName’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">AdditionalSubmitArgs</span></code> <span class="raw-html">&rarr;</span> Any valid sbatch parameter (raw)
(more <a class="reference external" href="https://slurm.schedmd.com/sbatch.html">info</a>)</p>
<blockquote>
<div><ul class="simple">
<li><p>e.g. <code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalProperties</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">AdditionalSubmitArgs</span></span> <span class="punctuation"><span class="pre">=</span></span> <span class="literal string"><span class="pre">‘–no-requeue’</span></span><span class="punctuation"><span class="pre">;</span></span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ol class="arabic simple">
<li><p>Save the current profile to avoid setting the properties each time.</p></li>
</ol>
<blockquote>
<div><div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">configCluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">TimeLimit</span> <span class="p">=</span> <span class="s">&#39;1:00:00&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">Partition</span> <span class="p">=</span> <span class="s">&#39;longjobs&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">saveProfile</span>

<span class="o">&gt;&gt;</span> <span class="c">% e.g. to set the NumGpus, TimeLimit and Partition</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">();</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">TimeLimit</span> <span class="p">=</span> <span class="s">&#39;1:00:00&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">Partition</span> <span class="p">=</span> <span class="s">&#39;accel&#39;</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">NumGpus</span> <span class="p">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">saveProfile</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="submitting-jobs">
<h3><a class="toc-backref" href="#id18">Submitting jobs</a><a class="headerlink" href="#submitting-jobs" title="Permalink to this headline">¶</a></h3>
<div class="section" id="general-steps">
<h4>General steps<a class="headerlink" href="#general-steps" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Load <em>‘apolo R2019a’</em> cluster profile and load the desired properties
to submit a job.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>There was no necessary to set the additional properties because they have
been already set when the profile was saved the first time with <code class="code bash docutils literal notranslate"><span class="pre">c.saveProfile</span></code>.</p>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>To see the values of the current configuration options, call the specific
<code class="docutils literal notranslate"><span class="pre">AdditionalProperties</span></code> method.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% To view current properties</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span>
</pre></div>
</div>
</li>
<li><p>To clear a value, assign the property an empty value (<code class="docutils literal notranslate"><span class="pre">''</span></code>,
<code class="docutils literal notranslate"><span class="pre">[]</span></code>, or <code class="docutils literal notranslate"><span class="pre">false</span></code>).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Turn off email notifications</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">EmailAddress</span> <span class="p">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>If you have to cancel a job (queued or running) type.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">cancel</span>
</pre></div>
</div>
</li>
<li><p>Delete a job after results are no longer needed.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">delete</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="serial-jobs">
<h4>Serial jobs<a class="headerlink" href="#serial-jobs" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Use the batch command to submit asynchronous jobs to the cluster. The batch
command will return a job object  which is used to access the output of the
submitted job.</p>
<p>(See the MATLAB documentation for more help on <a class="reference external" href="https://la.mathworks.com/help/distcomp/batch.html">batch</a>.)</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/072192272f42965b9033e2294156e9dc/serial_example.m"><code class="xref download docutils literal notranslate"><span class="pre">serial_example.m</span></code></a></span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>t <span class="p">=</span><span class="w"> </span><span class="nf">serial_example</span><span class="p">(</span>n<span class="p">)</span><span class="w"></span>

<span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

<span class="n">for</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:n</span>
    <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>

<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span><span class="p">;</span>

<span class="n">end</span>
</pre></div>
</div>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit job to query where MATLAB is running on the cluster (script)</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(@</span><span class="n">serial_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">1000</span><span class="p">});</span>

<span class="o">&gt;&gt;</span> <span class="c">% Query job for state</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>

<span class="o">&gt;&gt;</span> <span class="c">% Load results</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">fetchOutputs</span><span class="p">{:}</span>

<span class="o">&gt;&gt;</span> <span class="c">% Delete the job after results are no longer needed</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">delete</span>
</pre></div>
</div>
</li>
<li><p>To retrieve a list of currently running or completed jobs, call <code class="docutils literal notranslate"><span class="pre">parcluster</span></code>
to retrieve the cluster object.  The cluster object stores an array of jobs
that were run, are running, or are queued to run.  This allows us to fetch
the results of completed jobs.  Retrieve and view the list of jobs as shown
below.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">jobs</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Jobs</span>
</pre></div>
</div>
</li>
<li><p>Once we have identified the job we want, we can retrieve the results as
we have done previously. <code class="docutils literal notranslate"><span class="pre">fetchOutputs</span></code> is used to retrieve function output
arguments; if using batch with a script, use <code class="docutils literal notranslate"><span class="pre">load</span></code> instead.</p>
<p>Data that has been written to files on the cluster needs be retrieved
directly from the file system. To view results of a previously completed job:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle on job with ID 2</span>
<span class="o">&gt;&gt;</span> <span class="n">j2</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Jobs</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">j2</span><span class="p">.</span><span class="n">fetchOutputs</span><span class="p">{:}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can view a list of your jobs, as well as their IDs, using the above
<code class="code matlab docutils literal notranslate"><span class="name"><span class="pre">c</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">Jobs</span></span></code> command.</p>
</div>
</li>
<li><p>Another example using a MATLAB script.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/a0f0823e4ae0220956ef7f847ca7a450/serial_example_script.m"><code class="xref download docutils literal notranslate"><span class="pre">serial_example_script.m</span></code></a></span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">fileID</span> <span class="p">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#39;/tmp/time.txt&#39;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">);</span>
<span class="n">for</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:100</span>
    <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>
<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span><span class="p">;</span>
<span class="n">fprintf</span><span class="p">(</span><span class="n">fileID</span><span class="p">,</span> <span class="s">&#39;%6.4f\n&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">fileID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<ul>
<li><p>Job submission</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit job to query where MATLAB is running on the cluster (script)</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="s">&#39;serial_example_script&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Query job for state</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>

<span class="o">&gt;&gt;</span> <span class="c">%Load results into the client workspace</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">load</span>

<span class="o">&gt;&gt;</span> <span class="c">% Delete the job after results are no longer needed</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">delete</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Another example using a MATLAB script that supports GPU.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/dbff459f125303f8fc7f577d02d71349/gpu_script.m"><code class="xref download docutils literal notranslate"><span class="pre">gpu_script.m</span></code></a></span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">maxIterations</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span>
<span class="n">gridSize</span> <span class="p">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="n">xlim</span> <span class="p">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.748766713922161</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.748766707771757</span><span class="p">];</span>
<span class="n">ylim</span> <span class="p">=</span> <span class="p">[</span> <span class="mf">0.123640844894862</span><span class="p">,</span>  <span class="mf">0.123640851045266</span><span class="p">];</span>

<span class="c">% Setup</span>
<span class="n">t</span> <span class="p">=</span> <span class="n">tic</span><span class="p">();</span>
<span class="n">x</span> <span class="p">=</span> <span class="n">gpuArray</span><span class="p">.</span><span class="nb">linspace</span><span class="p">(</span> <span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">xlim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">gridSize</span> <span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">gpuArray</span><span class="p">.</span><span class="nb">linspace</span><span class="p">(</span> <span class="n">ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">gridSize</span> <span class="p">);</span>
<span class="p">[</span><span class="n">xGrid</span><span class="p">,</span><span class="n">yGrid</span><span class="p">]</span> <span class="p">=</span> <span class="nb">meshgrid</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">);</span>
<span class="n">z0</span> <span class="p">=</span> <span class="nb">complex</span><span class="p">(</span> <span class="n">xGrid</span><span class="p">,</span> <span class="n">yGrid</span> <span class="p">);</span>
<span class="n">count</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span> <span class="nb">size</span><span class="p">(</span><span class="n">z0</span><span class="p">),</span> <span class="s">&#39;gpuArray&#39;</span> <span class="p">);</span>

<span class="c">% Calculate</span>
<span class="n">z</span> <span class="p">=</span> <span class="n">z0</span><span class="p">;</span>
<span class="n">for</span> <span class="s">n</span> <span class="s">=</span> <span class="s">0:maxIterations</span>
          <span class="n">z</span> <span class="p">=</span> <span class="n">z</span><span class="o">.*</span><span class="n">z</span> <span class="o">+</span> <span class="n">z0</span><span class="p">;</span>
<span class="n">inside</span> <span class="p">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">z</span> <span class="p">)</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">count</span> <span class="p">=</span> <span class="n">count</span> <span class="o">+</span> <span class="n">inside</span><span class="p">;</span>
<span class="n">end</span>
<span class="s">count</span> <span class="s">=</span> <span class="s">log(</span> <span class="s">count</span> <span class="s">)</span><span class="p">;</span>

<span class="c">% Show</span>
<span class="n">count</span> <span class="p">=</span> <span class="n">gather</span><span class="p">(</span> <span class="n">count</span> <span class="p">);</span> <span class="c">% Fetch the data back from the GPU</span>
<span class="n">naiveGPUTime</span> <span class="p">=</span> <span class="n">toc</span><span class="p">(</span> <span class="n">t</span> <span class="p">);</span>
<span class="n">fig</span> <span class="p">=</span> <span class="n">gcf</span><span class="p">;</span>
<span class="n">fig</span> <span class="p">=</span> <span class="n">figure</span><span class="p">(</span><span class="s">&#39;visible&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">);</span>
<span class="n">fig</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="p">[</span><span class="mi">200</span> <span class="mi">200</span> <span class="mi">600</span> <span class="mi">600</span><span class="p">];</span>
<span class="n">imagesc</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">count</span> <span class="p">);</span>
<span class="n">colormap</span><span class="p">(</span> <span class="p">[</span><span class="n">jet</span><span class="p">();</span><span class="nb">flipud</span><span class="p">(</span> <span class="n">jet</span><span class="p">()</span> <span class="p">);</span><span class="n">0</span> <span class="s">0</span> <span class="s">0]</span> <span class="s">)</span><span class="p">;</span>
<span class="n">axis</span> <span class="s">off</span><span class="p">;</span>
<span class="n">title</span><span class="p">(</span> <span class="n">sprintf</span><span class="p">(</span> <span class="s">&#39;%1.2fsecs (GPU)&#39;</span><span class="p">,</span> <span class="n">naiveGPUTime</span> <span class="p">)</span> <span class="p">);</span>
<span class="n">saveas</span><span class="p">(</span><span class="n">gcf</span><span class="p">,</span><span class="s">&#39;/tmp/GPU.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<ul>
<li><p>Job submission</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit job to query where MATLAB is running on the cluster (script)</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="s">&#39;gpu_script&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Query job for state</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Another example using Simulink via MATLAB.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/7ee5e7e2822396da470a11b5981a6053/parsim_test_script.m"><code class="xref download docutils literal notranslate"><span class="pre">parsim_test_script.m</span></code></a></span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Example running a Simulink model.</span>

<span class="c">% The Simulink model is called |parsim_test.slx| and it *must be* in</span>
<span class="c">% the cluster.</span>

<span class="c">% Number of simulations</span>
<span class="n">numSims</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">W</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numSims</span><span class="p">);</span>

<span class="c">% Changing to the |parsim_test.slx| path</span>
<span class="n">cd</span> <span class="s">~/tests/simulink</span>

<span class="c">% Create an array of |SimulationInput| objects and specify the argument value</span>
<span class="c">% for each simulation. The variable |x| is the input variable in the Simulink</span>
<span class="c">% model.</span>
<span class="k">for</span> <span class="n">x</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">numSims</span>
  <span class="n">simIn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">=</span> <span class="n">Simulink</span><span class="p">.</span><span class="n">SimulationInput</span><span class="p">(</span><span class="s">&#39;parsim_test&#39;</span><span class="p">);</span>
  <span class="n">simIn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">=</span> <span class="n">setBlockParameter</span><span class="p">(</span><span class="n">simIn</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s">&#39;parsim_test/Transfer Fcn&#39;</span><span class="p">,</span> <span class="s">&#39;Denominator&#39;</span><span class="p">,</span> <span class="n">num2str</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="n">end</span>

<span class="s">%</span> <span class="s">Running</span> <span class="s">the</span> <span class="s">simulations.</span>
<span class="n">simOut</span> <span class="p">=</span> <span class="n">parsim</span><span class="p">(</span><span class="n">simIn</span><span class="p">);</span>

<span class="c">% The variable |y| is the output variable in the Simulink model.</span>
<span class="k">for</span> <span class="n">x</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">numSims</span>
  <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="n">simOut</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">));</span>
<span class="n">end</span>

<span class="s">save(&#39;~/output_file.mat&#39;,&#39;W&#39;)</span><span class="p">;</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../../_downloads/e4465a83c6a8daf3708fa1fe69728573/parsim_test.slx"><code class="xref download docutils literal notranslate"><span class="pre">parsim_test.slx</span> <span class="pre">(Simulink</span> <span class="pre">model)</span></code></a></p>
<ul>
<li><p>Job submission</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo remote R2018a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit job to query where MATLAB is running on the cluster (script)</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="s">&#39;parsim_test_script&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Query job for state</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>

<span class="o">&gt;&gt;</span> <span class="c">% Load data to client workspace</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">load</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="parallel-or-distributed-jobs">
<h4>Parallel or distributed jobs<a class="headerlink" href="#parallel-or-distributed-jobs" title="Permalink to this headline">¶</a></h4>
<p>Users can also submit parallel or distributed workflows with batch command.
Let’s use the following example for a parallel job.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/2d1becf8f198f949103c064c3af11b72/parallel_example.m"><code class="xref download docutils literal notranslate"><span class="pre">parallel_example.m</span></code></a></span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>t <span class="p">=</span><span class="w"> </span><span class="nf">parallel_example</span><span class="p">(</span>n<span class="p">)</span><span class="w"></span>

<span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="n">parfor</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:n</span>
  <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>
<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span><span class="p">;</span>
<span class="n">end</span>
</pre></div>
</div>
</div>
<ol class="arabic">
<li><p>We will use the batch command again, but since we are running a parallel job,
we will also specify a MATLAB pool.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit a batch pool job using 4 workers</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(@</span><span class="n">parallel_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">1000</span><span class="p">},</span> <span class="s">&#39;Pool&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% View current job status</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>

<span class="o">&gt;&gt;</span> <span class="c">% Fetch the results after a finished state is retrieved</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">fetchOutputs</span><span class="p">{:}</span>
<span class="nb">ans</span> <span class="p">=</span>
   <span class="mf">41.7692</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The job ran in 41.7692 seconds using 4 workers.</p></li>
</ul>
<blockquote>
<div><p><br/></p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that these jobs will always request N+1 CPU cores, since one worker
is required to manage the batch job and pool of workers.
For example, a job that needs eight workers will consume nine CPU cores.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For some applications, there will be a diminishing return when allocating
too many workers, as the overhead may exceed computation
time (communication).</p>
</div>
</li>
<li><p>We will run the same simulation, but increase the pool size.  This time, to
retrieve the results later, we will keep track of the job ID.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit a batch pool job using 8 workers</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(@</span><span class="n">parallel_example</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">1000</span><span class="p">},</span> ‘<span class="n">Pool</span>’<span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Get the job ID</span>
<span class="o">&gt;&gt;</span> <span class="n">id</span> <span class="p">=</span> <span class="nb">j</span><span class="p">.</span><span class="n">ID</span>
<span class="n">Id</span> <span class="p">=</span>
<span class="n">4</span>
<span class="s">&gt;&gt;</span> <span class="s">%</span> <span class="s">Clear</span> <span class="s">workspace,</span> <span class="s">as</span> <span class="s">though</span> <span class="s">we</span> <span class="s">quit</span> <span class="s">MATLAB</span>
<span class="o">&gt;&gt;</span> <span class="n">clear</span>
</pre></div>
</div>
</li>
<li><p>Once we have a handle to the cluster, we will call the <code class="docutils literal notranslate"><span class="pre">findJob</span></code> method to
search for the job with the specified job ID.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Find the old job</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">findJob</span><span class="p">(</span><span class="s">&#39;ID&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Retrieve the state of the job</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>
<span class="nb">ans</span>
<span class="n">finished</span>
<span class="s">&gt;&gt;</span> <span class="s">%</span> <span class="s">Fetch</span> <span class="s">the</span> <span class="s">results</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">fetchOutputs</span><span class="p">{:}</span>
<span class="nb">ans</span> <span class="p">=</span>
<span class="mf">22.2082</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The job now runs 22.2082 seconds using 8 workers.
Run code with different number of workers to determine the ideal number to use.</p></li>
</ul>
<blockquote>
<div><p><br/></p>
</div></blockquote>
</li>
<li><p>Another example using a parallel script.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/23384b7584008039157967a89924690b/parallel_example_script.m"><code class="xref download docutils literal notranslate"><span class="pre">parallel_example_script.m</span></code></a></span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="p">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="n">fileID</span> <span class="p">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#39;/tmp/time.txt&#39;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">);</span>

<span class="n">parfor</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:n</span>
  <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>

<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span><span class="p">;</span>
<span class="n">fprintf</span><span class="p">(</span><span class="n">fileID</span><span class="p">,</span> <span class="s">&#39;%6.4f\n&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">fileID</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Get a handle to the cluster</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo R2019a&#39;</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Submit job to query where MATLAB is running on the cluster (script)</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="s">&#39;parallel_example_script&#39;</span><span class="p">,</span> <span class="s">&#39;Pool&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

<span class="o">&gt;&gt;</span> <span class="c">% Query job for state</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">State</span>

<span class="o">&gt;&gt;</span> <span class="c">%Load results</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">load</span>

<span class="o">&gt;&gt;</span> <span class="c">% Delete the job after results are no longer needed</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">delete</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="debugging">
<h3><a class="toc-backref" href="#id19">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p>If a serial job produces an error, we can call the <code class="docutils literal notranslate"><span class="pre">getDebugLog</span></code> method to view
the error log file using <em>j.Tasks(1)</em>. Additionally  when submitting
independent jobs, with multiple tasks, you will have to specify the task
number.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% If necessary, retrieve output/error log file</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">Parent</span><span class="p">.</span><span class="n">getDebugLog</span><span class="p">(</span><span class="nb">j</span><span class="p">.</span><span class="n">Tasks</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>For pool jobs, do not diference into the job object.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% If necessary, retrieve output/error log file</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">Parent</span><span class="p">.</span><span class="n">getDebugLog</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="c">% or</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">getDebugLog</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>To get information about the job in SLURM, we can consult the scheduler ID
by calling <code class="docutils literal notranslate"><span class="pre">schedID</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">schedID</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span>
   <span class="nb">ans</span> <span class="p">=</span>
      <span class="n">25539</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="mdcs-using-cluster-s-matlab-client">
<h2><a class="reference external" href="https://la.mathworks.com/products/distriben.html">MDCS</a> using cluster’s MATLAB client<a class="headerlink" href="#mdcs-using-cluster-s-matlab-client" title="Permalink to this headline">¶</a></h2>
<div class="section" id="submitting-jobs-from-within-matlab-client-on-the-cluster">
<h3><a class="toc-backref" href="#id21">Submitting jobs from within MATLAB client on the cluster</a><a class="headerlink" href="#submitting-jobs-from-within-matlab-client-on-the-cluster" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4>General steps<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>Connect to Apolo II or Cronos via SSH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Without graphical user interface</span>
ssh username@<span class="o">[</span>cronos,apolo<span class="o">]</span>.eafit.edu.co
<span class="c1"># or with graphical user interface</span>
ssh -X username@<span class="o">[</span>cronos,apolo<span class="o">]</span>.eafit.edu.co
</pre></div>
</div>
</li>
<li><p>Load MATLAB modufile.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load matlab/r2019a
</pre></div>
</div>
</li>
<li><p>Run MATLAB client</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>matlab
</pre></div>
</div>
</li>
<li><p>First time, you have to define the cluster profile running the following
command.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">configCluster</span>

  <span class="o">&gt;&gt;</span> <span class="c">% Must set TimeLimit before submitting jobs to</span>
          <span class="o">&gt;&gt;</span> <span class="c">% the cluster.</span>

          <span class="o">&gt;&gt;</span> <span class="c">% i.e. to set the TimeLimit</span>
          <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;cluster R2019a&#39;</span><span class="p">);</span>
          <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">TimeLimit</span> <span class="p">=</span> <span class="s">&#39;1:00:00&#39;</span><span class="p">;</span>
          <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">saveProfile</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="code bash docutils literal notranslate"><span class="pre">configCluster</span></code> command should be run only the very first time you configure your MATLAB
client. It is NOT necessary to run the command each time.</p>
</div>
</li>
<li><p>Load the cluster profile to submit a job (MATLAB GUI or command line).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Must set TimeLimit before submitting jobs to Apolo II or</span>
<span class="o">&gt;&gt;</span> <span class="c">% Cronos cluster</span>

<span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">()</span>

  <span class="n">c</span> <span class="p">=</span>

   <span class="n">Generic</span> <span class="s">Cluster</span>

      <span class="n">Properties</span><span class="p">:</span>

                     <span class="n">Profile</span><span class="p">:</span> <span class="n">cluster</span> <span class="n">R2019a</span>
                    <span class="n">Modified</span><span class="p">:</span> <span class="n">false</span>
                        <span class="n">Host</span><span class="p">:</span> <span class="n">apolo</span><span class="p">.</span><span class="n">eafit</span><span class="p">.</span><span class="n">edu</span><span class="p">.</span><span class="n">co</span>
                  <span class="n">NumWorkers</span><span class="p">:</span> <span class="mi">96</span>
                  <span class="n">NumThreads</span><span class="p">:</span> <span class="mi">1</span>

          <span class="n">JobStorageLocation</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/&lt;</span><span class="n">user</span><span class="o">&gt;/</span><span class="n">MdcsDataLocation</span><span class="o">/</span><span class="n">cluster</span><span class="o">/</span><span class="n">R2019a</span><span class="o">/</span><span class="n">local</span>
           <span class="n">ClusterMatlabRoot</span><span class="p">:</span> <span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">common</span><span class="o">-</span><span class="n">apps</span><span class="o">/</span><span class="n">matlab</span><span class="o">/</span><span class="n">r2019a</span>
             <span class="n">OperatingSystem</span><span class="p">:</span> <span class="n">unix</span>

     <span class="n">RequiresOnlineLicensing</span><span class="p">:</span> <span class="n">false</span>
   <span class="n">IntegrationScriptsLocation</span><span class="p">:</span> <span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">common</span><span class="o">-</span><span class="n">apps</span><span class="o">/</span><span class="n">matlab</span><span class="o">/</span><span class="n">r2019a</span><span class="o">/</span><span class="n">toolbox</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">cluster</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">IntegrationScripts</span><span class="o">/</span><span class="n">cluster</span>
        <span class="n">AdditionalProperties</span><span class="p">:</span> <span class="n">List</span> <span class="k">properties</span>

      <span class="n">Associated</span> <span class="s">Jobs:</span>

              <span class="n">Number</span> <span class="s">Pending:</span> <span class="s">0</span>
               <span class="n">Number</span> <span class="s">Queued:</span> <span class="s">0</span>
              <span class="n">Number</span> <span class="s">Running:</span> <span class="s">0</span>
             <span class="n">Number</span> <span class="s">Finished:</span> <span class="s">0</span>
</pre></div>
</div>
</li>
<li><p>To see the values of the current configuration options, call the specific
<code class="docutils literal notranslate"><span class="pre">AdditionalProperties</span></code> method.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% To view current properties</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span>

  <span class="nb">ans</span> <span class="p">=</span>

    <span class="n">AdditionalProperties</span> <span class="s">with</span> <span class="s">properties:</span>

               <span class="n">AccountName</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
      <span class="n">AdditionalSubmitArgs</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
              <span class="n">EmailAddress</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
                 <span class="n">EmailType</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
               <span class="n">EnableDebug</span><span class="p">:</span> <span class="mi">0</span>
                  <span class="n">MemUsage</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
                 <span class="n">Partition</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
              <span class="n">ProcsPerNode</span><span class="p">:</span> <span class="mi">0</span>
               <span class="n">Reservation</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
                 <span class="n">TimeLimit</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
                   <span class="n">UseSmpd</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>To clear a value, assign the property an empty value (<code class="docutils literal notranslate"><span class="pre">''</span></code>,
<code class="docutils literal notranslate"><span class="pre">[]</span></code>, or <code class="docutils literal notranslate"><span class="pre">false</span></code>).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="c">% Turn off email notifications</span>
<span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">EmailAddress</span> <span class="p">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id3">
<h4>Submitting jobs<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users can submit serial, parallel or distributed jobs with batch command
as the previous examples.</p>
</div>
</div>
</div>
<div class="section" id="submitting-jobs-directly-through-slurm">
<h3><a class="toc-backref" href="#id22">Submitting jobs directly through SLURM</a><a class="headerlink" href="#submitting-jobs-directly-through-slurm" title="Permalink to this headline">¶</a></h3>
<p>MDCS jobs could be submitted directly from the Unix command line through SLURM.</p>
<p>For this, in addition to the MATLAB source, one needs to prepare a MATLAB
submission script with the job specifications.</p>
<ol class="arabic">
<li><p>An example is shown below:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/4bbc2f5e280d268947f7c1d2c8ec2368/matlab_batch.m"><code class="xref download docutils literal notranslate"><span class="pre">matlab_batch.m</span></code></a></span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%==========================================================</span>
<span class="c">% MATLAB job submission script: matlab_batch.m</span>
<span class="c">%==========================================================</span>

<span class="n">workers</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;SLURM_NTASKS&#39;</span><span class="p">));</span>
<span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo&#39;</span><span class="p">);</span>
<span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">TimeLimit</span> <span class="p">=</span> <span class="s">&#39;1:00:00&#39;</span><span class="p">;</span>
<span class="n">c</span><span class="p">.</span><span class="n">AdditionalProperties</span><span class="p">.</span><span class="n">Partition</span> <span class="p">=</span> <span class="s">&#39;longjobs&#39;</span><span class="p">;</span> 
<span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">batch</span><span class="p">(@</span><span class="n">parallel_example_slurm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">1000</span><span class="p">},</span> <span class="s">&#39;pool&#39;</span><span class="p">,</span> <span class="n">workers</span><span class="p">);</span>
<span class="n">exit</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/a7d1c6396731f1fb818493af52e036cb/parallel_example_slurm.m"><code class="xref download docutils literal notranslate"><span class="pre">parallel_example_slurm.m</span></code></a></span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>t <span class="p">=</span><span class="w"> </span><span class="nf">parallel_example_slurm</span><span class="p">(</span>n<span class="p">)</span><span class="w"></span>

<span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

<span class="n">parfor</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:n</span>
  <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>

<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span><span class="p">;</span>
<span class="n">save</span> <span class="s">prueba.txt</span> <span class="s">t</span> <span class="s">-ascii</span>

<span class="n">end</span>
</pre></div>
</div>
</div>
</li>
<li><p>It is submitted to the queue with help of the following SLURM batch-job
submission script:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/9177ce490133fd9f977583af2906c78b/matlab.slurm"><code class="xref download docutils literal notranslate"><span class="pre">matlab.slurm</span></code></a></span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH -J test_matlab</span>
<span class="c1">#SBATCH -o test_matlab-%j.out</span>
<span class="c1">#SBATCH -e test_matlab-%j.err</span>
<span class="c1">#SBATCH -p longjobs</span>
<span class="c1">#SBATCH -n 8</span>
<span class="c1">#SBATCH -t 20:00</span>
 
module load matlab/r2018a

matlab -nosplash -nodesktop -r <span class="s2">&quot;matlab_batch&quot;</span>
</pre></div>
</div>
</div>
</li>
<li><p>Job is submitted as usual with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch matlab.slurm
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This scheme dispatches 2 jobs - one serial that spawns the actual MDCS
parallel jobs, and another, the actual parallel job.</p>
</div>
</li>
<li><p>Once submitted, the job can be monitored and managed directly through SLURM</p>
<ul>
<li><p><code class="code bash docutils literal notranslate"><span class="pre">squeue</span></code> command output</p>
<img alt="squeue output" src="../../../../_images/slurm1.png" />
</li>
</ul>
</li>
<li><p>After the job completes, one can fetch results and delete job object from
within MATLAB client on the cluster. If program writes directly to disk
fetching is not necessary.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="p">=</span> <span class="n">parcluster</span><span class="p">(</span><span class="s">&#39;apolo&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">jobs</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Jobs</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Jobs</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">fetchOutputs</span><span class="p">{:};</span>
<span class="o">&gt;&gt;</span> <span class="nb">j</span><span class="p">.</span><span class="n">delete</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="matlab-directly-on-the-cluster">
<h2><a class="toc-backref" href="#id23">MATLAB directly on the cluster</a><a class="headerlink" href="#matlab-directly-on-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>Next steps describes how to use MATLAB and its toolboxes without MDCS (workers)
toolbox, but this way has next pros and cons.</p>
<ul class="simple">
<li><p><strong>Pros</strong></p>
<ul>
<li><p>No workers limitations</p></li>
</ul>
</li>
<li><p><strong>Cons</strong></p>
<ul>
<li><p>No distributed jobs (Only parallel or serial jobs)</p></li>
</ul>
</li>
</ul>
<div class="section" id="unattended-job">
<h3><a class="toc-backref" href="#id24">Unattended job</a><a class="headerlink" href="#unattended-job" title="Permalink to this headline">¶</a></h3>
<p>To run unattended jobs on the cluster follow next steps:</p>
<ol class="arabic">
<li><p>Connect to Apolo II or Cronos via SSH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh username@cronos.eafit.edu.co
</pre></div>
</div>
</li>
<li><p>Enter to the matlab directory project.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/test/matlab/slurm
</pre></div>
</div>
</li>
<li><p>Create a SLURM batch-job submission script</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/f10be7a63dc8552d84c0f149917f733b/slurm.sh"><code class="xref download docutils literal notranslate"><span class="pre">slurm.sh</span></code></a></span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH -J test_matlab</span>
<span class="c1">#SBATCH -o test_matlab-%j.out</span>
<span class="c1">#SBATCH -e test_matlab-%j.err</span>
<span class="c1">#SBATCH -p bigmem</span>
<span class="c1">#SBATCH -n 8</span>
<span class="c1">#SBATCH -t 20:00</span>
 
module load matlab/r2018a

matlab -nosplash -nodesktop &lt; parallel_example_unattended.m
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../../../../_downloads/e95b82b23a0ed46d164bc44076469482/parallel_example_unattended.m"><code class="xref download docutils literal notranslate"><span class="pre">parallel_example_unattended.m</span></code></a></span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="p">=</span> <span class="n">parpool</span><span class="p">(</span><span class="n">str2num</span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;SLURM_NTASKS&#39;</span><span class="p">)));</span>

<span class="n">t0</span> <span class="p">=</span> <span class="n">tic</span><span class="p">;</span>
<span class="n">A</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span> 
<span class="n">a</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="n">parfor</span> <span class="s">i</span> <span class="s">=</span> <span class="s">1:1000</span>
  <span class="n">a</span><span class="p">(</span><span class="nb">i</span><span class="p">)</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="n">A</span><span class="p">))));</span>
<span class="n">end</span>
<span class="s">t</span> <span class="s">=</span> <span class="s">toc(t0)</span>
<span class="n">exit</span>
</pre></div>
</div>
</div>
</li>
<li><p>Submit the job.</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch slurm.sh
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p>Check the <code class="code bash docutils literal notranslate"><span class="pre">stdout</span></code> file (<code class="code bash docutils literal notranslate"><span class="pre">test_matlab_xxxx.out</span></code>).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>                      <span class="o">&lt;</span> <span class="n">M</span> <span class="n">A</span> <span class="n">T</span> <span class="n">L</span> <span class="n">A</span> <span class="n">B</span> <span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">&gt;</span>
            <span class="n">Copyright</span> <span class="s">1984-2019</span> <span class="s">The</span> <span class="s">MathWorks,</span> <span class="s">Inc.</span>
       <span class="n">R2019a</span> <span class="s">Update</span> <span class="s">3</span> <span class="s">(9.6.0.1135713)</span> <span class="s">64-bit</span> <span class="s">(glnxa64)</span>
                         <span class="n">June</span> <span class="s">5,</span> <span class="s">2019</span>

<span class="n">To</span> <span class="s">get</span> <span class="s">started,</span> <span class="s">type</span> <span class="s">doc.</span>
<span class="n">For</span> <span class="s">product</span> <span class="s">information,</span> <span class="s">visit</span> <span class="s">www.mathworks.com.</span>

<span class="o">&gt;&gt;</span> <span class="n">Starting</span> <span class="n">parallel</span> <span class="n">pool</span> <span class="p">(</span><span class="n">parpool</span><span class="p">)</span> <span class="n">using</span> <span class="n">the</span> <span class="s">&#39;local&#39;</span> <span class="n">profile</span> <span class="c">...</span>
<span class="n">connected</span> <span class="s">to</span> <span class="s">8</span> <span class="s">workers.</span>

<span class="n">t</span> <span class="p">=</span>

  <span class="mf">22.5327</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="interactive-job-no-gui">
<h3><a class="toc-backref" href="#id25">Interactive job (No GUI)</a><a class="headerlink" href="#interactive-job-no-gui" title="Permalink to this headline">¶</a></h3>
<p>If it is necessary the user can run interactive jobs  following next steps:</p>
<ol class="arabic">
<li><p>Connect to Apolo II or Cronos via SSH.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh username@apolo.eafit.edu.co
</pre></div>
</div>
</li>
<li><p>Submit a interactive request to the resource manager</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -N <span class="m">1</span> --ntasks-per-node<span class="o">=</span><span class="m">2</span> -t <span class="m">20</span>:00 -p debug --pty bash
<span class="c1"># If resources are available you get immediately a shell in a slave node</span>
<span class="c1"># e.g. compute-0-6</span>
module load matlab/r2019a
matlab
</pre></div>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>                            <span class="o">&lt;</span> <span class="n">M</span> <span class="n">A</span> <span class="n">T</span> <span class="n">L</span> <span class="n">A</span> <span class="n">B</span> <span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">&gt;</span>
                  <span class="n">Copyright</span> <span class="s">1984-2019</span> <span class="s">The</span> <span class="s">MathWorks,</span> <span class="s">Inc.</span>
             <span class="n">R2019a</span> <span class="s">Update</span> <span class="s">3</span> <span class="s">(9.6.0.1135713)</span> <span class="s">64-bit</span> <span class="s">(glnxa64)</span>
                               <span class="n">June</span> <span class="s">5,</span> <span class="s">2019</span>

<span class="n">To</span> <span class="s">get</span> <span class="s">started,</span> <span class="s">type</span> <span class="s">doc.</span>
<span class="n">For</span> <span class="s">product</span> <span class="s">information,</span> <span class="s">visit</span> <span class="s">www.mathworks.com.</span>

 <span class="o">&gt;&gt;</span> <span class="n">p</span> <span class="p">=</span> <span class="n">parpool</span><span class="p">(</span><span class="n">str2num</span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;SLURM_NTASKS&#39;</span><span class="p">)));</span>
 <span class="n">Starting</span> <span class="s">parallel</span> <span class="s">pool</span> <span class="s">(parpool)</span> <span class="s">using</span> <span class="s">the</span> <span class="s">&#39;local&#39;</span> <span class="s">profile</span> <span class="s">...</span>
 <span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">NumWorkers</span>

 <span class="nb">ans</span> <span class="p">=</span>

      <span class="n">2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At this point you have an interactive MATLAB session through the resource
manager (SLURM), giving you the possibility to test and check different
MATLAB features.</p>
</div>
</li>
<li><p>To finish this job, you have to close the MATLAB session and then the bash
session granted in the slave node.</p></li>
</ol>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id26">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.mathworks.com/products/parallel-computing.html">Parallel Computing Toolbox</a></p></li>
<li><p><a class="reference external" href="https://la.mathworks.com/products/distriben.html">MATLAB Distributed Computing Server</a></p></li>
<li><p>“Portions of our documentation contain content originally created by Harvard
FAS Research Computing and adapted by us under the Creative Commons
Attribution-NonCommercial 4.0 International License. More information:
<a class="reference external" href="https://rc.fas.harvard.edu/about/attribution/">https://rc.fas.harvard.edu/about/attribution/</a>”</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../python/index.html" class="btn btn-neutral float-right" title="Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral float-left" title="Tested on (Requirements)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Creative Commons Attribution-NonCommercial 4.0 International License

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>