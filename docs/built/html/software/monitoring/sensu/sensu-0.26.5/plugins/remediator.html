

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sensu Plugin - Remediator &mdash; apolo-docs 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/sidebar.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="Sensu Plugin - Mailer" href="mailer.html" />
    <link rel="prev" title="Sensu - 0.26.5" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

  
    <a href="../../../../../index.html">
  

  
    
    <img src="../../../../../_static/apolo-white.png" style="width: 150px;" class="logo" alt="Logo"/>
  
    </a>

    
      
      
      
	<div class="version" style="color: rgba(255,255,255,0.5);">
	  0.1
	</div>
      
    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../gettingstarted/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../supercomputers/index.html">Supercomputers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Software</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../virtualization/index.html">Virtualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../programminglanguages/index.html">Programming Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../applications/index.html">Scientific Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../resourcemanager/index.html">Resource Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">Monitoring</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../architecture/index.html">Monitoring Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nagios/index.html">Nagios</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../index.html">Sensu</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../index.html">Sensu - 0.26.5</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../elk/index.html">ELK</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../grafana/index.html">Grafana</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../operatingsystems/index.html">Operating Systems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../how-to-acknowledge.html">How to Acknowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../report-a-bug.html">Report a Bug</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">apolo-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Software</a> &raquo;</li>
        
          <li><a href="../../../index.html">Monitoring</a> &raquo;</li>
        
          <li><a href="../../index.html">Sensu</a> &raquo;</li>
        
          <li><a href="../index.html">Sensu - 0.26.5</a> &raquo;</li>
        
      <li>Sensu Plugin - Remediator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/software/monitoring/sensu/sensu-0.26.5/plugins/remediator.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sensu-plugin-remediator">
<span id="remediator-index"></span><h1><a class="toc-backref" href="#id5">Sensu Plugin - Remediator</a><a class="headerlink" href="#sensu-plugin-remediator" title="Permalink to this headline">¶</a></h1>
<p>This plugin reads configuration from a check definition and triggers
specified remediation actions (defined as other checks) via the
Sensu API when the occurrences and severities reach certain values. <a class="footnote-reference brackets" href="#id3" id="id1">1</a></p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sensu-plugin-remediator" id="id5">Sensu Plugin - Remediator</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-information" id="id6">Basic information</a></p></li>
<li><p><a class="reference internal" href="#installation" id="id7">Installation</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id8">Configuration</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id9">Usage</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting" id="id10">Troubleshooting</a></p>
<ul>
<li><p><a class="reference internal" href="#sudo-sorry-you-must-have-a-tty-to-run-sudo" id="id11">sudo: sorry, you must have a tty to run sudo</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id12">References</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basic-information">
<h2><a class="toc-backref" href="#id6">Basic information</a><a class="headerlink" href="#basic-information" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>License:</strong> MIT License</p></li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id7">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The entire process of installation and configuration has to be executed only in the
Sensu Server.</p>
</div>
<p>The handler is a Ruby script that can be downloaded from the official repository: <a class="reference external" href="https://github.com/sensu-plugins/sensu-plugins-sensu/blob/master/bin/handler-sensu.rb">https://github.com/sensu-plugins/sensu-plugins-sensu/blob/master/bin/handler-sensu.rb</a>. It can be located in
<code class="code bash docutils literal notranslate"><span class="pre">/etc/sensu/handlers/remediator.rb</span></code></p>
</div>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id8">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Add the Remediator configuration file:</p>
<p><strong>Example:</strong> <code class="file docutils literal notranslate"><span class="pre">/etc/sensu/conf.d/handlers/remediator.json</span></code></p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
  <span class="s2">&quot;handlers&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;remediator&quot;</span>: <span class="o">{</span>
      <span class="s2">&quot;command&quot;</span>: <span class="s2">&quot;/etc/sensu/handlers/remediator.rb&quot;</span>,
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;pipe&quot;</span>,
      <span class="s2">&quot;severities&quot;</span>: <span class="o">[</span><span class="s2">&quot;critical&quot;</span><span class="o">]</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id9">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Remediator is a Sensu handler that triggers actions when a defined check service changes
to critical status. The way Remediator triggers this action is executing it in the hosts
that follow a subscription with the hostname of the client that failed.</p>
<p><strong>Example:</strong> A compute node called <strong>test-node</strong> fails in a defined monitoring check. Remediator
triggers the defined action in the hosts that follow the subscription <strong>test-node</strong>.</p>
<p>That’s why every host that wants to receive the trigger from <strong>Remediator</strong>
has to be subscribed to its hostname.</p>
<p>The procedure for setting a handler for a check with remediator is:</p>
<ol class="arabic">
<li><p>Add the hostname as a subscription in each node that will execute the handler.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;HOSTNAME&quot;</span><span class="p">,</span>
      <span class="s2">&quot;bmc_address&quot;</span><span class="p">:</span> <span class="s2">&quot;10.0.0.1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;subscriptions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;subscription-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subscription-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HOSTNAME&quot;</span>
      <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Create the definition of the check that will be executed to <em>remediate</em> a CRITICAL result.</p>
<p><strong>Example:</strong> If the service ssh is down, the check that will remediate that is the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;remediate-service-ssh&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;service sshd start&quot;</span><span class="p">,</span>
      <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;remediator&quot;</span><span class="p">],</span>
      <span class="s2">&quot;subscribers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ssh&quot;</span><span class="p">],</span>
      <span class="s2">&quot;standalone&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;publish&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Update the definition of the check that will trigger the remediator handler if changes
its state to CRITICAL. You have to add an attribute called remediation, specifying which
check will remediate the failure.</p>
<p><strong>Example:</strong> Checks if SSH is running. In this case, the check called <em>check-sshd</em> will be
remediated by the check <em>remediate-service-ssh</em> if it changes to severity 2 (CRITICAL) one or
more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;checks&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;check-sshd&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;check-process.rb -p /usr/sbin/sshd&quot;</span><span class="p">,</span>
      <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
      <span class="s2">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;remediator&quot;</span><span class="p">,</span><span class="s2">&quot;mailer&quot;</span><span class="p">],</span>
      <span class="s2">&quot;subscribers&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ssh&quot;</span><span class="p">],</span>
      <span class="s2">&quot;standalone&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
      <span class="s2">&quot;remediation&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;remediate-service-ssh&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">&quot;occurrences&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1+&quot;</span><span class="p">],</span>
          <span class="s2">&quot;severities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>If the handler needs superuser permissions to run its action, it’s necessary to add that
rule in the sudoers configuration in the Sensu-Clients.</p></li>
</ol>
</div>
<div class="section" id="troubleshooting">
<h2><a class="toc-backref" href="#id10">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sudo-sorry-you-must-have-a-tty-to-run-sudo">
<h3><a class="toc-backref" href="#id11">sudo: sorry, you must have a tty to run sudo</a><a class="headerlink" href="#sudo-sorry-you-must-have-a-tty-to-run-sudo" title="Permalink to this headline">¶</a></h3>
<p>This message appears when you need to run the remediator’s action as superuser,
you defined the rule in sudoer’s configuration but you haven’t specified that
the action requires a TTY.</p>
<p><strong>SOLUTION:</strong> Add the following line in the sudoers file. <a class="footnote-reference brackets" href="#id4" id="id2">2</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Defaults:sensu !requiretty
</pre></div>
</div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id12">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Sensu-Plugins. (n.d.). Sensu-plugins/sensu-plugins-sensu. Retrieved June 12, 2019,
from <a class="reference external" href="https://github.com/sensu-plugins/sensu-plugins-sensu/blob/master/bin/handler-sensu.rb">https://github.com/sensu-plugins/sensu-plugins-sensu/blob/master/bin/handler-sensu.rb</a></p>
</dd>
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Brousse, N. (2014, September 8). Sudo: Sorry, you must have a tty to run sudo.
Retrieved June 13, 2019, from
<a class="reference external" href="https://www.shell-tips.com/2014/09/08/sudo-sorry-you-must-have-a-tty-to-run-sudo/">https://www.shell-tips.com/2014/09/08/sudo-sorry-you-must-have-a-tty-to-run-sudo/</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mailer.html" class="btn btn-neutral float-right" title="Sensu Plugin - Mailer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="Sensu - 0.26.5" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Creative Commons Attribution-NonCommercial 4.0 International License

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>